version: 1
frontend:
  phases:
    preBuild:
      commands:
        - nvm install 22.14.0
        - nvm use 22.14.0
        - curl -fsSL https://get.pnpm.io/install.sh | sh -
        - export PATH="$HOME/.local/share/pnpm:$PATH"
        - echo "STORE_PATH=$(pnpm store path)" >> .env
    build:
      commands:
        - pnpm install
        - pnpm build
        # Clean up unnecessary files to reduce artifact size
        - find .next -name "*.map" -type f -delete || true
        - rm -rf .next/cache .next/trace || true
  artifacts:
    baseDirectory: .next
    files:
      - '**/*'
  cache:
    paths:
      - '.next/cache/**/*'
      - '.pnpm-store/**/*'
